---
- name: setup group
  group: name={{ zookeeper_group }} system=yes

- name: setup user
  user: name={{ zookeeper_user }} system=yes group={{ zookeeper_group }}

- name: create upstart config
  template: dest=/etc/init/zookeeper.conf src=upstart.conf.j2
  notify:
    - restart zookeeper
    - wait for zookeeper port

- include: ../../../tasks/deploy.yml
  vars:
    url: http://apache.mirrors.tds.net/zookeeper/zookeeper-{{zookeeper_version}}/zookeeper-{{zookeeper_version}}.tar.gz
    package: zookeeper-{{zookeeper_version}}.tar.gz
    dest: "{{ zookeeper_install_dir }}"

- name: create symlink to conf directory
  file: path={{zookeeper_conf_dir}} state=link src=/opt/zookeeper/conf

- name: create data directory
  file: path={{zookeeper_data_dir}} state=directory owner=zookeeper group=zookeeper mode=755

- name: create log directory
  file: path={{zookeeper_log_dir}} state=directory owner=zookeeper group=zookeeper mode=755

- name: Setup zoo.cfg
  template: dest="{{zookeeper_conf_dir}}/zoo.cfg" src=zoo.cfg.j2 force="yes"
  notify:
    - restart zookeeper
    - wait for zookeeper port

- name: Setup log4j
  template: dest="{{zookeeper_conf_dir}}/log4j.properties" src=log4j.properties.j2 force="yes"
  notify:
    - restart zookeeper
    - wait for zookeeper port

- name: Setup myid
  template: dest="{{zookeeper_data_dir}}/myid" src=myid.j2 force="yes"
  notify:
    - restart zookeeper
    - wait for zookeeper port


